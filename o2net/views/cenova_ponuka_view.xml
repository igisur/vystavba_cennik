<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.ui.view" id="view_form_cenova_ponuka_polozka">
            <field name="name">cenova ponuka polozka</field>
            <field name="model">o2net.cenova_ponuka.polozka</field>
            <field name="priority" eval="5"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <div class="oe_title">
                        <h1>
                            <field name="name" nolabel="1" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <field name="kod" readonly="1"/>
                        <field name="polozka_mj" readonly="1" string="MJ"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="cena_jednotkova" widget="monetary" options="{'currency_field': 'currency_id'}" readonly="1"/>
                    </group>

                    <div class="oe_clear"/>

                    <label for="polozka_popis"/>
                    <field name="polozka_popis" readonly="1"/>
                </form>
            </field>
        </record>

        <!-- VIEWS -->
        <record model="ir.ui.view" id="view_form_cenova_ponuka">
            <field name="name">cenova ponuka</field>
            <field name="model">o2net.cenova_ponuka</field>
            <field name="priority" eval="5"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <!-- use class="oe_highlight" to suggest WF action -->
                        <button name="assign" type="workflow" string="Priradiť" class="oe_highlight" states="draft" groups="o2net.group_vystavba_pc,o2net.group_vystavba_admin"/>
                        <button name="in_progress" type="workflow" string="Rozpracovať" class="oe_highlight" states="assigned" groups="o2net.group_vystavba_supplier,o2net.group_vystavba_admin"/>
                        <button name="to_approve" type="workflow" string="Odoslať na schválenie" class="oe_highlight" states="in_progress" groups="o2net.group_vystavba_supplier,o2net.group_vystavba_admin"/>
                        <button name="approve" type="workflow" string="Schváliť" class="oe_highlight" states="to_approve" groups="o2net.group_vystavba_pc,o2net.group_vystavba_pm,o2net.group_vystavba_manager,o2net.group_vystavba_admin"/>
                        <button name="wf_not_complete" type="object" string="Vratiť na opravu" states="to_approve" groups="o2net.group_vystavba_pc,o2net.group_vystavba_pm,o2net.group_vystavba_admin"/>
                        <button name="cancel" type="workflow" string="Zrušiť" states="to_approve" groups="o2net.group_vystavba_pc,o2net.group_vystavba_pm,o2net.group_vystavba_manager,o2net.group_vystavba_admin"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,assigned,in_progress,to_approve,approved" readonly="1"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button string="Export SAP" name="action_exportSAP" type="object" icon="fa-file-text-o" groups="o2net.group_vystavba_admin"/>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <label string="Cenová ponuka"/>
                                <field name="id" invisible="True"/>
                                <field name="name" attrs="{'readonly':[('state','in',['approved'])]}"/>
                                <field name="ro_datumoddo" invisible="True"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="cislo" reuired="True"  attrs="{'readonly':[('state','not in',['draft', 'in_progress'])]}"/>
                                <field name="financny_kod"  attrs="{'readonly':[('state','not in',['draft','in_progress'])]}"/>
                                <field name="skratka"  attrs="{'readonly':[('state','not in',['draft','in_progress'])]}"/>
                                <field name="datum_zaciatok" attrs="{'readonly':[('ro_datumoddo','=',True)], 'required':[('ro_datumoddo','!=',True)]}"/>
                                <field name="datum_koniec" attrs="{'readonly':[('ro_datumoddo','=',True)], 'required':[('ro_datumoddo','!=',True)]}"/>
                                <field name="sap_export_file_binary" filename="sap_export_file_name" readonly="True" attrs="{'invisible':[('state','not in',['approved'])]}"/>
                                <field name="sap_export_file_binary" filename="sap_export_file_name" readonly="True" groups="o2net.group_vystavba_admin"/>
                            </group>
                            <group>
                                <field name="dodavatel_id" attrs="{'readonly':[('state','not in',['draft'])]}" options="{'no_create': True}" context="{'group_name':'TEST_GROUP'}"/>
                                <field name="pc_id" attrs="{'readonly':[('state','not in',['draft'])]}" options="{'no_create': True}" />
                                <field name="pm_id" attrs="{'readonly':[('state','not in',['draft'])]}" options="{'no_create': True}"/>
                                <!--<field name="manager_id" readonly="True" options="{'no_create': True}"/>-->
                                <!--<field name="osoba_priradena_id" readonly="True"/>-->
                                <field name="manager_ids" readonly="True" options="{'no_create': True}" widget="many2many_tags"/>
                                <field name="osoba_priradena_ids" readonly="True" options="{'no_create_edit': True}" widget="many2many_tags"/>
                                <field name="cennik_id" attrs="{'readonly':[('state','not in',['draft'])]}" options="{'no_create': True}" class="oe_read_only"/>
                                <field name="currency_id" invisible="1" class="oe_read_only"/>
                            </group>

                        </group>

                        <notebook>
                            <page string="Položky">
                                <field name="cp_polozka_ids" attrs="{'readonly':[('state','in',['approved'])]}">
                                    <tree string="Polozky cennika" editable="bottom">
                                        <!--<field name="cennik_polozka_id" string="Položky" options="{'no_create': True}"/>-->
                                        <field name="cennik_polozka_id" string="Položky" options="{'no_create': True}" domain="[('polozka_id.is_balicek','!=','True')]"/>
                                        <field name="polozka_mj" readonly="1" string="Mj"/>
                                        <field name="cena_jednotkova" string="Jednotková cena"/>
                                        <field name="mnozstvo"  string="Počet"/>
                                        <field name="cena_celkom" string="Celková cena"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Balíčky">
                                <field name="cp_polozka_balicek_ids" attrs="{'readonly':[('state','in',['approved'])]}">
                                    <tree string="Balicky cennika" editable="bottom">
                                        <!--<field name="cennik_polozka_id" string="Balíčky" options="{'no_create': True}"/>-->
                                        <field name="cennik_polozka_id" string="Balíčky" options="{'no_create': True}" domain="[('polozka_id.is_balicek','=','True')]"/>
                                        <field name="polozka_mj" readonly="1" string="Merná jednotka"/>
                                        <field name="cena_jednotkova"/>
                                        <field name="mnozstvo"  string="Počet"/>
                                        <field name="cena_celkom" string="Cena"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Atypické položky" attrs="{'readonly':[('state','in',['approved'])]}">
                                <field name="cp_polozka_atyp_ids">
                                    <tree string="Polozky cennika" editable="bottom">
                                        <field name="oddiel_id" string="Oddiel" options="{'no_create': True}"/>
                                        <field name="name"  string="Položka"/>
                                        <field name="cena" string="Cena"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>

                        <group class="oe_subtotal_footer oe_right">
                            <div class="oe_subtotal_footer_separator oe_inline">
                                <label for="celkova_cena"/>
                            </div>
                            <field name="celkova_cena" nolabel="1" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                        </group>
                        <div class="oe_clear"/>

                        <!-- class="oe_inline" -->
                        <label for="poznamka"/>
                        <field name="poznamka" attrs="{'readonly':[('state','in',['approved'])]}"/>
                        <label for="wf_dovod"/>
                        <field name="wf_dovod" attrs="{'invisible':[('state','in',['approved'])]}"/>

                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- zobrazenie pre vsetky stavy okrem 'draft'
        -->
        <record model="ir.ui.view" id="view_tree_cenova_ponuka">
            <field name="name">cenova ponuka</field>
            <field name="model">o2net.cenova_ponuka</field>
            <field name="priority" eval="5"/>
            <field name="type">tree</field>
            <field name="arch" type="xml">

                <tree string="Cenova ponuka" edit="false" create="false" delete="false">
                    <field name="name"/>
                    <field name="cislo"/>
                    <field name="financny_kod"/>
                    <field name="datum_zaciatok"/>
                    <field name="datum_koniec"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="celkova_cena" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    <field name="dodavatel_id"/>
                    <field name="osoba_priradena_ids" string="Priradený" widget="one2many_list"/>
                </tree>
            </field>
        </record>

        <!-- zobrazenie pre vsetky cenove ponuky v stave 'draft'
            nepotrebujeme: priradenu osobu, celkovu cenu
        -->
        <record model="ir.ui.view" id="view_tree_cenova_ponuka_draft">
            <field name="name">cenova ponuka</field>
            <field name="model">o2net.cenova_ponuka</field>
            <field name="priority" eval="5"/>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="red:dodavatel_id==False">
                  <field name="name"/>
                  <field name="cislo"/>
                  <field name="financny_kod"/>
                  <field name="skratka"/>
                  <field name="dodavatel_id"/>
                  <field name="osoba_priradena_ids" string="Priradený" widget="one2many_list"/>
                </tree>
            </field>
        </record>

        <!-- zobrazenie pre vsetky cenove ponuky podla stavu -->
        <record model="ir.ui.view" id="view_tree_cenova_ponuka_preview">
            <field name="name">cenova ponuka</field>
            <field name="model">o2net.cenova_ponuka</field>
            <field name="priority" eval="6"/>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="blue:state == 'draft';green:state == 'assigned';orange:state == 'in_progress';red:state == 'to_approve';gray:state == 'cancel'"
                        edit="false" create="false" delete="false">
                    <field name="state"/>
                    <field name="name"/>
                    <field name="cislo"/>
                    <field name="financny_kod"/>
                    <field name="datum_zaciatok" string="Začaté"/>
                    <field name="datum_koniec" string="Ukončené"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="celkova_cena"  string="Cena" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                    <field name="dodavatel_id"/>
                    <field name="osoba_priradena_ids" string="Priradený" widget="one2many_list"/>
                </tree>
            </field>
        </record>

        <!-- ACTIONS -->
       <!-- PC: vytvorenie a zoznam vytvorenych navrhov CP -->
        <record model="ir.actions.act_window" id="action_window_cp_draft">
            <field name="name">Návrh cenovej ponuky</field>
            <field name="res_model">o2net.cenova_ponuka</field>
            <field name="view_id" ref="view_tree_cenova_ponuka_draft"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state','=','draft')]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">Klikni pre založenie novej hlavičky cenovej ponuky.</p>
                <p>Tu nájdete založené cenové ponuky.</p>
            </field>
        </record>

        <!-- Dodavatel: zoznam priradenych navrhov CP. to-do pool navrhov CP, ktoré su priradene dodavatelovy. ak ich zedituje stavaju sa "rozpracované" -->
        <record model="ir.actions.act_window" id="action_window_cp_assigned">
            <field name="name">Priradené cenové ponuky</field>
            <field name="res_model">o2net.cenova_ponuka</field>
            <field name="view_id" ref="view_tree_cenova_ponuka"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain"> [('state','=','assigned')]</field>
            <field name="help" type="html">
                <p>Tu nájdete cenové ponuky, ktoré sú priradené na dodávateľa.</p>
            </field>
        </record>

        <!-- Dodavatel: zoznam rozpracovanych CP. to-do pool navrhov CP, ktoré treba dospecifikovat a posunut ich na schvalenie -->
        <record model="ir.actions.act_window" id="action_window_cp_in_progress">
            <field name="name">Rozpracované cenové ponuky</field>
            <field name="res_model">o2net.cenova_ponuka</field>
            <field name="view_id" ref="view_tree_cenova_ponuka"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain"> [('state','=','in_progress')]</field>
            <field name="help" type="html">
                <p>Tu nájdete rozpracované cenové ponuky, kde ste ich dodávateľ.</p>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_window_cp_to_approve">
            <field name="name">Cenové ponuky čakajúce na schválenie</field>
            <field name="res_model">o2net.cenova_ponuka</field>
            <field name="view_id" ref="view_tree_cenova_ponuka"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain"> [('state','=','to_approve')]</field>
            <field name="help" type="html">
                <p>Tu nájdete cenové ponuky čakajúce na schválenie, ktoré sú vám priradené alebo ste ich dodávateľ.</p>
            </field>
        </record>

        <!-- Dodavatel / PC / PM / Manager: zoznam schvalenych CP (v podstate historia CP) READ ONLY -->
        <record model="ir.actions.act_window" id="action_window_cp_approved">
            <field name="name">Schválené cenové ponuky</field>
            <field name="res_model">o2net.cenova_ponuka</field>
            <field name="view_id" ref="view_tree_cenova_ponuka"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain"> [('state','=','approved')]</field>
            <field name="help" type="html">
                <p>Tu nájdete schválené cenové ponuky, ktoré vám boli priradené alebo ste ich dodávateľ.</p>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_window_cp_cancel">
            <field name="name">Zrušené cenové ponuky</field>
            <field name="res_model">o2net.cenova_ponuka</field>
            <field name="view_id" ref="view_tree_cenova_ponuka"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain"> [('state','=','cancel')]</field>
            <field name="help" type="html">
                <p>Tu nájdete zrušené cenové ponuky, ktoré vám boli priradené alebo ste ich dodávateľ.</p>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_window_cp_preview">
            <field name="name">Prehľad cenových ponúk</field>
            <field name="res_model">o2net.cenova_ponuka</field>
            <field name="view_id" ref="view_tree_cenova_ponuka_preview"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p>Tu nájdete všetky cenové ponuky, ktoré sú vám priradené alebo ste ich dodávateľ.</p>
            </field>
        </record>

        <!-- MENU -->
        <menuitem id="menu_cenova_ponuka_root"
                  name="Cenová ponuka"
                  sequence="10"
                  parent="menu_root"/>

        <menuitem id="menu_cenova_ponuka_draft"
                  name="Návrh"
                  sequence="11"
                  parent="menu_cenova_ponuka_root"
                  action="action_window_cp_draft"
                  groups="o2net.group_vystavba_supplier,o2net.group_vystavba_pc,o2net.group_vystavba_pm,o2net.group_vystavba_admin"/>

                  <!--groups="base.group_vystavba_pc,base.group_vystavba_pm,base.group_vystavba_admin"/>-->

        <menuitem id="menu_cenova_ponuka_assigned"
                  name="Priradené"
                  sequence="12"
                  parent="menu_cenova_ponuka_root"
                  action="action_window_cp_assigned"
                  groups="o2net.group_vystavba_supplier,o2net.group_vystavba_pc,o2net.group_vystavba_pm,o2net.group_vystavba_admin"/>
                  <!--groups="base.group_vystavba_supplier,base.group_vystavba_pc,base.group_vystavba_pm,base.group_vystavba_admin"/>-->

        <menuitem id="menu_cenova_ponuka_in_progress"
                  name="Rozpracované"
                  sequence="13"
                  parent="menu_cenova_ponuka_root"
                  action="action_window_cp_in_progress"
                  groups="o2net.group_vystavba_supplier,o2net.group_vystavba_pc,o2net.group_vystavba_pm,o2net.group_vystavba_admin"/>
                  <!--groups="base.group_vystavba_supplier,base.group_vystavba_pc,base.group_vystavba_pm,base.group_vystavba_admin"/>-->

        <menuitem id="menu_cenova_ponuka_to_approve"
                  name="Na schválenie"
                  sequence="14"
                  parent="menu_cenova_ponuka_root"
                  action="action_window_cp_to_approve"/>
                  <!--groups="base.group_vystavba_pc,base.group_vystavba_pm,base.group_vystavba_admin"/>-->

        <menuitem id="menu_cenova_ponuka_approved"
                  name="Schválené"
                  sequence="15"
                  parent="menu_cenova_ponuka_root"
                  action="action_window_cp_approved"/>

        <menuitem id="menu_cenova_ponuka_cancel"
                  name="Zrušené"
                  sequence="16"
                  parent="menu_cenova_ponuka_root"
                  action="action_window_cp_cancel"/>

        <menuitem id="menu_cenova_ponuka_preview"
                  name="Prehľad"
                  sequence="17"
                  parent="menu_cenova_ponuka_root"
                  action="action_window_cp_preview"/>
    </data>
</openerp>
