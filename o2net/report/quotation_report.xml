<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <template id="report_quotation_pdf_document">
             <t t-call="report.internal_layout">
                <div class="page">
                    <t t-set="d" t-value="doc" />
                    <t t-if="d.name"><h2><span t-field="d.name"/></h2></t>

                    <div class="row mt32 mb32">
                        <div t-if="d.shortname" class="col-xs-3">
                            <strong>Short name:</strong>
                            <p t-field="d.shortname"/>
                        </div>
                        <div t-if="d.financial_code" class="col-xs-3">
                            <strong>Financial code:</strong>
                            <p t-field="d.financial_code"/>
                        </div>
                        <div t-if="d.start_date" class="col-xs-3">
                            <strong>Start date:</strong>
                            <p t-field="d.start_date" t-field-options='{"format": "dd.MM.yyyy"}'/>
                        </div>
                        <div t-if="d.end_date" class="col-xs-3">
                            <strong>End date:</strong>
                            <p t-field="d.end_date" t-field-options='{"format": "dd.MM.yyyy"}'/>
                        </div>
                        <div t-if="d.project_number" class="col-xs-3">
                            <strong>Project number:</strong>
                            <p t-field="d.project_number"/>
                        </div>
                        <div t-if="d.vendor_id.name" class="col-xs-3">
                            <strong>Vendor:</strong>
                            <p t-field="d.vendor_id.name"/>
                        </div>
                        <div t-if="d.pc_id.name" class="col-xs-3">
                            <strong>PC:</strong>
                            <p t-field="d.pc_id.name"/>
                        </div>
                        <div t-if="d.pm_id.display_name" class="col-xs-3">
                            <strong>PM:</strong>
                            <p t-field="d.pm_id.display_name"/>
                        </div>
                    </div>

                    <!--<t t-set="rows" t-value="d._get_section(d.id)"/>-->
                    <t t-set="sections" t-value="d._get_section(d.id)"/>
                    <section>
                        <h3>ITEMS</h3>
                        <t t-foreach="sections[0]" t-as="section">
                            <div>
                                <table width="100%" style="margin-top:20px;margin-bottom:20px">
                                    <tr>
                                        <td style="font-size:18px;width:50%;" t-esc="section['section']"/>
                                        <td style="font-size:18px;width:50%;text-align:right;" t-esc="d._get_price_section(d.id, section['id'])[0]" t-esc-options='{"widget": "monetary", "display_currency": "d.currency_id"}'/>
                                    </tr>
                                </table>
                                <table>
                                    <tr>
                                        <table width="100%">
                                            <t t-set="rowstyp" t-value="d._get_rows_section_typ(d.id,section['id'])"/>
                                            <t t-set="index" t-value="0"/>
                                            <tr t-foreach="rowstyp[0]" t-as="rowtyp">
                                                <td>
                                                    <t t-set="index" t-value="index+1" />
                                                    <table style="width:100%">
                                                        <t t-if="index==1">
                                                            <thead style="border-bottom:1pt solid black;padding-bottom:40px;">
                                                                <tr>
                                                                    <th style="width:10%">Section</th>
                                                                    <th style="width:15%;text-align:left">KSZ</th>
                                                                    <th style="width:40%">Item</th>
                                                                    <th style="width:5%">Unit of measure</th>
                                                                    <th style="width:10%;text-align:right">Quantity</th>
                                                                    <th style="width:10%;text-align:right">Unite price</th>
                                                                    <th style="width:10%;text-align:right">Price</th>
                                                                </tr>
                                                            </thead>
                                                        </t>
                                                        <tbody>
                                                            <tr>
                                                                <td style="width:10%"><span t-esc="rowtyp['section']"/></td>
                                                                <td style="width:15%;text-align:left"><span t-esc="rowtyp['ksz']"/></td>
                                                                <td style="width:40%"><span t-esc="rowtyp['item']"/></td>
                                                                <td style="width:5%"><span t-esc="rowtyp['uom']"/></td>
                                                                <td style="width:10%;text-align:right"><span t-esc="d._format_number(rowtyp['quantity'])[0]"/></td>
                                                                <td style="width:10%;text-align:right"><span t-esc="d._format_number(rowtyp['unit_price'])[0]"/></td>
                                                                <td style="width:10%;text-align:right"><span t-esc="d._format_number(rowtyp['total_price'])[0]"/></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table width="100%" style="margin-top:10px" t-if="index>0">
                                            <tr>
                                                <td width="75%" style="font-size:16px;text-align:right;font-weight:bold;">Total price - items</td>
                                                <td width="25%" style="font-size:16px;text-align:right;font-weight:bold;"><span t-esc="d._format_number(d._get_price_section_atyp(d.id, section['id'], 0)[0],d.currency_id)[0]"/></td>
                                            </tr>
                                        </table>
                                    </tr>
                                </table>
                                <table width="100%">
                                    <tr>
                                        <table width="100%">
                                            <t t-set="rowsatyp" t-value="d._get_rows_section_atyp(d.id,section['id'])"/>
                                            <t t-set="indexatyp" t-value="0" />
                                            <tr t-foreach="rowsatyp[0]" t-as="rowatyp">
                                                <td>
                                                    <t t-set="indexatyp" t-value="indexatyp+1" />
                                                    <t t-if="indexatyp==1">
                                                        <h5>Atypical items</h5>
                                                    </t>
                                                    <table style="width:100%">
                                                        <t t-if="indexatyp==1">
                                                            <thead style="border-bottom:1pt solid black;padding-bottom:40px;">
                                                                <tr>
                                                                    <th style="width:10%">Section</th>
                                                                    <th style="width:75%">Item</th>
                                                                    <th style="width:15%;text-align:right">Price</th>
                                                                </tr>
                                                            </thead>
                                                        </t>
                                                        <tbody>
                                                            <tr>
                                                                <td style="width:10%"><span t-esc="rowatyp['section']"/></td>
                                                                <td style="width:75%"><span t-esc="rowatyp['item']"/></td>
                                                                <td style="width:15%;text-align:right"><span t-esc="d._format_number(rowatyp['total_price'])[0]"/></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table width="100%" style="margin-top:10px" t-if="indexatyp>0">
                                            <tr>
                                                <td style="font-size:16px;width:75%;text-align:right;font-weight:bold;">Total price - atypical items</td>
                                                <td style="font-size:16px;width:25%;text-align:right;font-weight:bold;"><span t-esc="d._format_number(d._get_price_section_atyp(d.id, section['id'], 1)[0],d.currency_id)[0]"/></td>
                                            </tr>
                                        </table>
                                    </tr>
                                </table>
                            </div>
                        </t>
                    </section>
                    <section>
                        <h3>PACKAGES</h3>
                        <table width="100%">
                            <tr>
                                <table width="100%">
                                    <t t-set="rowspackage" t-value="d._get_rows_section_package(d.id)"/>
                                    <t t-set="indexpackage" t-value="0" />
                                    <tr t-foreach="rowspackage[0]" t-as="rowpackage">
                                        <td>
                                            <t t-set="indexpackage" t-value="indexpackage+1" />
                                            <table style="width:100%">
                                                <t t-if="indexpackage==1">
                                                    <thead style="border-bottom:1pt solid black;padding-bottom:40px;">
                                                        <tr>
                                                            <th style="width:10%">Code</th>
                                                            <th style="width:50%">Item</th>
                                                            <th style="width:10%;text-align:right">Quantity</th>
                                                            <th style="width:10%;text-align:right">Unit price</th>
                                                            <th style="width:10%;text-align:right">Price</th>
                                                        </tr>
                                                    </thead>
                                                </t>
                                                <tbody>
                                                    <tr>
                                                        <td style="width:10%"><span t-esc="rowpackage['code']"/></td>
                                                        <td style="width:50%"><span t-esc="rowpackage['item']"/></td>
                                                        <td style="width:10%;text-align:right"><span t-esc="d._format_number(rowpackage['quantity'])[0]"/></td>
                                                        <td style="width:10%;text-align:right"><span t-esc="d._format_number(rowpackage['unit_price'])[0]"/></td>
                                                        <td style="width:10%;text-align:right"><span t-esc="d._format_number(rowpackage['total_price'])[0]"/></td> <!-- '{0:,2f}'.format(int(rowpackage['total_price'])) t-esc-options='{"widget": "monetary", "display_currency": "d.currency_id"}'-->
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                                <table width="100%" style="margin-top:10px" t-if="indexpackage>0">
                                    <tr>
                                        <td style="width:75%;font-size:16px;text-align:right;font-weight:bold;">Packages total</td>
                                        <td style="width:25%;font-size:16px;text-align:right;font-weight:bold;"><span t-esc="d._format_number(d._get_price_packages(d.id)[0],d.currency_id)[0]"/></td>
                                    </tr>
                                </table>
                            </tr>
                        </table>
                    </section>
                    <section>
                        <div t-if="d.total_price">
                            <table width="100%" style="margin-top:55px">
                                <tr>
                                    <td style="font-size:16px;text-align:right;font-weight: bold;">Items total:</td>
                                    <td style="font-size:16px;text-align:right;font-weight: bold;"><span t-esc="d._format_number(d._get_price_items(d.id)[0],d.currency_id)[0]"/></td>
                                </tr>
                                <tr>
                                    <td style="font-size:16px;text-align:right;font-weight: bold;">Packages total:</td>
                                    <td style="font-size:16px;text-align:right;font-weight: bold;"><span t-esc="d._format_number(d._get_price_packages(d.id)[0],d.currency_id)[0]"/></td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="text-align:right;">--------------------------------------------</td>
                                </tr>
                                <tr>
                                    <td style="font-size:24px;text-align:right;font-weight: bold;">Total price:</td>
                                    <td style="font-size:24px;text-align:right;font-weight: bold;"><span t-esc="d._format_number(d.total_price,d.currency_id)[0]" /></td>
                                </tr>
                            </table>
                        </div>
                    </section>
                </div>
             </t>
        </template>

        <template id="report_quotation_pdf_document_header">
            <!--<t t-call="report.internal_layout">-->
                <div class="header">
                    <div class="text-center" style="border-top: font-size:12px; padding-top: 2px">
                        <t>
                            O2 Slovakia, s.r.o. | Einsteinova 24 | 851 01 Bratislava | Slovakia<br/>
                            E-mail: info@o2.sk | Website: http://www.o2.sk | IČO: 35848863 | DIČ: 2020216748 | IČ DPH: SK2020216748<br/>
                            Zapísaná v OR SR: OS Bratislava I, odd: Sro, vložka číslo: 27882/B<br/>
                            Bankové spojenie: UniCredit Bank Czech Republic and Slovakia, a.s.: IBAN SK4211110000001156173009 - SWIFT UNCRSKBX
                        </t>
                    </div>
                </div>
            <!--</t>-->
        </template>

        <template id="report_quotation_pdf_document_footer">
            <t t-call="report.internal_layout">
                <div class="footer">
                    <table width="100%">
                        <tr>
                            <td>
                                Printed: <span t-field="user.name"/> - <span t-esc="time.strftime('%Y-%m-%d %H:%M:%S')"/>
                            </td>
                            <td style="text-align:right;">
                                <span class="page"/> / <span class="topage"/>
                            </td>
                        </tr>
                    <!--<div class="row">Printed: <span t-field="user.name"/> - <span t-esc="time.strftime('%Y-%m-%d %H:%M:%S')"/>-->
                    <!--    <ul class="list-inline">-->
                    <!--        <li><span class="page"/> / <span class="topage"/></li>-->
                    <!--    </ul>-->
                    <!--</div>-->
                    </table>
                </div>
            </t>
        </template>

        <template id="report_quotation_pdf">
            <t t-call="report.html_container">
                <t t-call="o2net.report_quotation_pdf_document_header"/>
                <t t-foreach="docs" t-as="doc">
                    <t t-call="o2net.report_quotation_pdf_document"/>
                </t>
                <t t-call="o2net.report_quotation_pdf_document_footer"/>
            </t>
        </template>

    </data>
</openerp>